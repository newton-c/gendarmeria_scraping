prs$prov[[j]] <- prov[[i]]
}
} else {
for (i in seq_along(prov)) {
for (j in seq_length(nrow(prs))) {
if (is.na(prs$prov)) {
if (prov[[i]] %in% prs$text) {
prs$prov[[j]] <- prov[[i]]
}
} else {
prs$prov[[j]] <- "Multiple Provinces listed"
}
}
}
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov)) {
if (prov[[i]] %in% prs$text) {
prs$prov[[j]] <- prov[[i]]
}
} else {
prs$prov[[j]] <- "Multiple Provinces listed"
}
}
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov)) {
if (prov[[i]] %in% prs$text) {
prs$prov[[j]] <- prov[[i]]
}
} else {
prs$prov[[j]] <- "Multiple Provinces listed"
}
}
}
if (is.na(prs$prov[[j]])) {
if (prov[[i]] %in% prs$text) {
prs$prov[[j]] <- prov[[i]]
}
} else {
prs$prov[[j]] <- "Multiple Provinces listed"
}
prs <- read_csv("data/gendameria_2023-06-07.csv")
prs$prov <- NA
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
if (prov[[i]] %in% prs$text) {
prs$prov[[j]] <- prov[[i]]
}
} else {
prs$prov[[j]] <- "Multiple Provinces listed"
}
}
}
View(prs)
class(prov)
prov <- read_html("https://es.wikipedia.org/wiki/Provincias_de_Argentina") %>%
html_elements("td") %>%
html_elements("b") %>%
html_elements("a") %>%
html_attr("title") %>%
as.list
View(prov)
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
if (prov[[i]] %in% prs$text) {
prs$prov[[j]] <- prov[[i]]
}
} else {
prs$prov[[j]] <- "Multiple Provinces listed"
}
}
}
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
print("It's NA")
if (prov[[i]] %in% prs$text) {
prs$prov[[j]] <- prov[[i]]
}
} else {
prs$prov[[j]] <- "Multiple Provinces listed"
}
}
}
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
if (prov[[i]] %in% prs$text) {
print("It seems to work")
prs$prov[[j]] <- prov[[i]]
}
} else {
prs$prov[[j]] <- "Multiple Provinces listed"
}
}
}
if (prov[[i]] %in% prs$text[[j]]) {
print("It seems to work")
prs$prov[[j]] <- prov[[i]]
}
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
if (prov[[i]] %in% prs$text[[j]]) {
print("It seems to work")
prs$prov[[j]] <- prov[[i]]
}
} else {
prs$prov[[j]] <- "Multiple Provinces listed"
}
}
}
prs$text[[1]]
"los" %in% prs$text[[1]]
"los" %in% prs$text[[1]][[1]]
los %in% prs$text[[1]][[1]]
"los" %in% as.character(prs$text[[1]][[1]])
str_extract("los", prs$text[[1]])
str_extract("los", prs$text[1])
str_extract("los", prs$text)
str_extract("a", prs$text)
str_extract(prs$text[[1]], "los")
prs$text[[2]]
prov <- read_html("https://es.wikipedia.org/wiki/Provincias_de_Argentina") %>%
html_elements("td") %>%
html_elements("b") %>%
html_elements("a") %>%
html_attr("title") %>%
gsub("Provincia de ", "" )
prov <- read_html("https://es.wikipedia.org/wiki/Provincias_de_Argentina") %>%
html_elements("td") %>%
html_elements("b") %>%
html_elements("a") %>%
html_attr("title") %>%
gsub("Provincia de ", "" ) %>%
as.list
prov <- read_html("https://es.wikipedia.org/wiki/Provincias_de_Argentina") %>%
html_elements("td") %>%
html_elements("b") %>%
html_elements("a") %>%
html_attr("title") %>%
as.list() %>%
gsub("Provincia de ", "" )
gsub
?gsub
prov <- read_html("https://es.wikipedia.org/wiki/Provincias_de_Argentina") %>%
html_elements("td") %>%
html_elements("b") %>%
html_elements("a") %>%
html_attr("title") %>%
as.list() %>%
sub("Provincia de ", "", .)
prs$text[[2]]
prov <- read_html("https://es.wikipedia.org/wiki/Provincias_de_Argentina") %>%
html_elements("td") %>%
html_elements("b") %>%
html_elements("a") %>%
html_attr("title") %>%
sub("Provincia de ", "", .) %>%
as.list
str_extract(prs$text[[2]], prov[[9]])
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else {
prs$prov[[j]] <- "Multiple Provinces listed"
}
}
}
View(prs)
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
}
}
}
View(prs)
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
}
}
View(prs)
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (!is.na(prs$prov[[j]]))
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else {
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (!is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else {
prs$prov[[j]] <- paste(prs$prov[[j]],
str_extract(prs$text[[j]], prov[[i]]),
sep = ", ")
}
}
}
View(prs)
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else {
prs$prov[[j]] <- paste(prs$prov[[j]],
str_extract(prs$text[[j]], prov[[i]]),
sep = ", ")
}
}
}
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} if (!is.na(prs$prov[[j]])) {
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} if (!is.na(prs$prov[[j]])) {
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else if (!is.na(prs$prov[[j]])) {
prs$prov[[j]] <- paste(prs$prov[[j]],
str_extract(prs$text[[j]], prov[[i]]),
sep = ", ")
}
}
}
View(prs)
prs$prov <- sub("NA,", "", prs$prov)
prs$prov <- gsub("NA,", ",", prs$prov)
prs$prov <- gsub("NA,", "", prs$prov)
prs$prov <- gsub("NA, ", " ", prs$prov)
prs$prov <- gsub("NA,", ",", prs$prov)
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else if (!is.na(prs$prov[[j]])) {
match <- str_extract(prs$text[[j]], prov[[i]]) %>%
unique
prs$prov[[j]] <- paste(prs$prov[[j]],
match,
sep = ", ")
}
}
}
View(prs)
prs <- read_csv("data/gendameria_2023-06-07.csv")
prs$prov <- NA
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else if (!is.na(prs$prov[[j]])) {
match <- str_extract(prs$text[[j]], prov[[i]]) %>%
unique
prs$prov[[j]] <- paste(prs$prov[[j]],
match,
sep = ", ")
}
}
}
View(prs)
prs$prov <- gsub("NA,", "", prs$prov)
View(prs)
prs$prov <- gsub("NA", "", prs$prov)
prs$prov <- gsub("NA", "", prs$prov) %>%
gsub("\s+", prs$prov, perl = TRUE)
prs$prov <- gsub("NA", "", prs$prov) %>%
gsub(" +", prs$prov, perl = TRUE)
prs$prov <- gsub("NA", "", prs$prov)
prs$prov <- gsub(" +", prs$prov, perl = TRUE)
prs$prov <- gsub(" +", "", prs$prov, perl = TRUE)
View(prs)
prs$prov <- gsub(" ", "", prs$prov, perl = TRUE)
prs <- read_csv("data/gendameria_2023-06-07.csv")
prs$prov <- NA
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else if (!is.na(prs$prov[[j]])) {
match <- str_extract(prs$text[[j]], prov[[i]]) %>%
unique
prs$prov[[j]] <- paste(prs$prov[[j]],
match,
sep = ", ")
}
}
}
prs$prov <- gsub("NA", "", prs$prov) %>%
gsub(" ", "", prs$prov, perl = TRUE)
prs$prov <- gsub("NA", "", prs$prov)
prs$prov <- gsub(" ", "", prs$prov, perl = TRUE)
prs <- read_csv("data/gendameria_2023-06-07.csv")
prs$prov <- NA
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else if (!is.na(prs$prov[[j]])) {
match <- str_extract(prs$text[[j]], prov[[i]]) %>%
unique
prs$prov[[j]] <- paste(prs$prov[[j]],
match,
sep = ", ")
}
}
}
prs$prov <- gsub("NA", "", prs$prov)
prs$prov <- gsub(" ", "", prs$prov, perl = TRUE)
prs$prov <- gsub("\\s+", " ", prs$prov, perl = TRUE)
prs <- read_csv("data/gendameria_2023-06-07.csv")
prs$prov <- NA
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else if (!is.na(prs$prov[[j]])) {
match <- str_extract(prs$text[[j]], prov[[i]]) %>%
unique
prs$prov[[j]] <- paste(prs$prov[[j]],
match,
sep = ", ")
}
}
}
prs$prov <- gsub("NA", "", prs$prov)
prs$prov <- gsub("\\s+", " ", prs$prov, perl = TRUE)
prov <- read_html("https://es.wikipedia.org/wiki/Provincias_de_Argentina") %>%
html_elements("td") %>%
html_elements("b") %>%
html_elements("a") %>%
html_attr("title") %>%
sub("Provincia de ", "", .) %>%
as.list
prs <- read_csv("data/gendameria_2023-06-07.csv")
prs$prov <- NA
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else if (!is.na(prs$prov[[j]])) {
match <- str_extract(prs$text[[j]], prov[[i]]) %>%
unique
prs$prov[[j]] <- paste(prs$prov[[j]],
match,
sep = ", ")
}
}
}
prs$prov <- gsub("NA", "", prs$prov)
prs$prov <- gsub("\\s+", "", prs$prov, perl = TRUE)
prs$prov <- gsub(", ,", "", prs$prov)
prs <- read_csv("data/gendameria_2023-06-07.csv")
prs$prov <- NA
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else if (!is.na(prs$prov[[j]])) {
match <- str_extract(prs$text[[j]], prov[[i]]) %>%
unique
prs$prov[[j]] <- paste(prs$prov[[j]],
match,
sep = ", ")
}
}
}
prs$prov <- gsub("NA", "", prs$prov)
prs$prov <- gsub("\\s+", " ", prs$prov, perl = TRUE)
prs$prov <- gsub(", ,", "", prs$prov)
prs$prov <- gsub("\\s+,", ",", prs$prov, perl = TRUE)
prs$prov <- gsub(",$", "", prs$prov, perl = TRUE)
View(prs)
prs <- read_csv("data/gendameria_2023-06-07.csv")
prs$prov <- NA
for (i in seq_along(prov)) {
for (j in seq_len(nrow(prs))) {
if (is.na(prs$prov[[j]])) {
prs$prov[[j]] <- str_extract(prs$text[[j]], prov[[i]])
} else if (!is.na(prs$prov[[j]])) {
match <- str_extract(prs$text[[j]], prov[[i]]) %>%
unique
prs$prov[[j]] <- paste(prs$prov[[j]],
match,
sep = " ")
}
}
}
prs$prov <- gsub("NA", "", prs$prov)
prs$prov <- gsub("\\s+", " ", prs$prov, perl = TRUE)
url <- "https://www.argentina.gob.ar/gendarmeria/noticias"
max_pages <- read_html(url) %>%
html_element("#pager-last")
library(tidyverse)
library(rvest)
#library(ICplots)
#library(purrr)
library(furrr) # multicore maps
library(parallel) # for detectCores()
plan(multisession, workers = detectCores() - 1) # use all but one core
url <- "https://www.argentina.gob.ar/gendarmeria/noticias"
max_pages <- read_html(url) %>%
html_element("#pager-last")
View(max_pages)
max_pages <- read_html(url) %>%
html_element(".pager-last")
View(max_pages)
View(max_pages)
max_pages <- read_html(url) %>%
html_element(".pager-last") %>%
html_text()
max_pages <- read_html(url) %>%
html_element(".pager-last") %>%
html_attr("href") %>%
html_text()
max_pages <- read_html(url) %>%
html_element(".pager-last") %>%
html_attr("href")
max_pages <- read_html(url) %>%
html_element(".pager-last")
View(max_pages)
xml_attrs(max_pages)
max_pages <- read_html(url) %>%
html_attr(".pager-last")
max_pages <- read_html(url) %>%
html_elements(".pager-last")
View(max_pages)
max_pages <- read_html(url) %>%
html_elements(".pager-last") %>%
html_element("a")
max_pages <- read_html(url) %>%
html_elements(".pager-last") %>%
html_text2()
max_pages <- read_html(url) %>%
html_elements(".pager-last") %>%
html_element("href")
View(max_pages)
max_pages <- read_html(url)# %>%
View(max_pages)
html_text2(max_pages)
max_pages %>% html_elements("pager-last")
max_pages %>% html_elements(".pager-last")
max_pages %>% html_elements(".pager-last") %>% html_attr("href")
max_pages %>% html_elements(".pager-last") %>% html_attr(".href")
max_pages %>% html_elements(".pager-last") %>% html_attr("a")
max_pages %>% html_elements(".pager-last") %>% html_element("a")
max_pages %>% html_elements(".pager-last") %>% html_element("a") %>% html_attr("href")
max_pages %>% html_elements(".pager-last") %>% html_element("a") %>% html_attr("href") %>% sub(".*page=", "", .)
max_pages <- read_html(url) %>%
html_element(".pager-last") %>%
html_element("a") %>%
html_attr("href") %>%
sub(".*page=", "", .)
source("~/Desktop/IC/2023/IC Datos/Argentina/gendarmería_scraping/scripts/scraper.R", echo=TRUE)
source("~/Desktop/IC/2023/IC Datos/Argentina/gendarmería_scraping/scripts/scraper.R", echo=TRUE)
Sys.Date()
print(paste0("gendarmeria_", Sys.Date())
)
source("~/Desktop/IC/2023/IC Datos/Argentina/gendarmería_scraping/scripts/scraper.R")
source("~/Desktop/IC/2023/IC Datos/Argentina/gendarmería_scraping/scripts/scraper.R")
View(all_articles)
# Search for Provinces
prs <- read_csv("data/gendameria_2023-07-12.csv")
library(tidyverse)
library(ICplots)
library(rvest)
# Search for Provinces
prs <- read_csv("data/gendameria_2023-07-12.csv")
# Search for Provinces
prs <- read_csv("data/gendameria_2023-07-12.csv")
# Search for Provinces
prs <- read_csv("data/gendarmeria_2023-07-12.csv")
View(prs)
# find press releases talking about contraband
contraband <- prs %>%
mutate(filter_col = grepl("contrabando" | "contrabandeado"))
# find press releases talking about contraband
contraband <- prs %>%
mutate(filter_col = grepl("contrabando" | "contrabandeado", text))
contraband <- prs %>%
mutate(filter_col = grepl(paste(contraband_keys, collapse='|'), text)) %>%
filter(filter_col == TRUE)
# find press releases talking about contraband
contraband_keys <- c("contrabando", "contrabandeado")
contraband <- prs %>%
mutate(filter_col = grepl(paste(contraband_keys, collapse='|'), text)) %>%
filter(filter_col == TRUE)
View(contraband)
# find press releases talking about contraband
contraband_keys <- c("contrabando", "contrabanda", "contrabandeado",
"aval legal")
contraband <- prs %>%
mutate(filter_col = grepl(paste(contraband_keys, collapse='|'), text)) %>%
filter(filter_col == TRUE)
View(contraband)
# find press releases talking about contraband
contraband_keys <- c("contrabando", "contrabanda", "contrabandeado",
"aval legal", "cigarillos")
contraband <- prs %>%
mutate(filter_col = grepl(paste(contraband_keys, collapse='|'), text)) %>%
filter(filter_col == TRUE)
